<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; overflow: hidden;}
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="three.js"></script>
		<script>
		var scene = new THREE.Scene;
		var camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );

		var raycaster = new THREE.Raycaster(); // create once
		var mouse = new THREE.Vector2(); // create once

		var renderer = new THREE.WebGLRenderer();
			renderer.setClearColor( 0x000000 );
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

		var video = new Object(document.createElement('video'));
			video.src = "movie.mp4";
			video.load();
			video.play();
			video.loop=true;
			video.setAttribute('crossorigin', 'anonymous');

		var video2 = new Object(document.createElement('video'));
			video2.src = "movie2.mp4";
			video2.load();
			video2.play();
			video2.loop=true;
			video2.setAttribute('crossorigin', 'anonymous');

		var texture = new THREE.VideoTexture( video );
			texture.minFilter = THREE.LinearFilter;
			texture.magFilter = THREE.LinearFilter;
			texture.format = THREE.RGBFormat;

		var texture2 = new THREE.VideoTexture( video2 );
			texture2.minFilter = THREE.LinearFilter;
			texture2.magFilter = THREE.LinearFilter;
			texture2.format = THREE.RGBFormat;

		var geometry = new THREE.PlaneGeometry( 3.2, 1.8, 0 );
		var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 } );
		var cube = new THREE.Mesh( geometry, material );

		var geometry2 = new THREE.PlaneGeometry( 3.2, 1.8, 0 );
		var material2 = new THREE.MeshBasicMaterial( { map: texture2, overdraw: 0.5 } );
		var cube2 = new THREE.Mesh( geometry2, material2 );

		scene.add( cube );
		scene.add( cube2 );

		cube.position.y = 1;
		cube2.position.y = -1;

		/*cube.geometry.dynamic = true;
		cube.geometry.__dirtyVertices = true;
		cube.vertices[0].position.z =  -0.5;*/

		camera.position.z = 5;

		function onMouseMove( event ) {
			mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
			mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
		}

		function render(){
			console.log(scene.children);
			raycaster.setFromCamera( mouse, camera );
			var intersects = raycaster.intersectObjects( scene.children );

			if (intersects.length == 1){
				intersects[ 0 ].object.material.color.set( 0xe5e5e5 );
			}
			else{
					for(i=0;i<scene.children.length;i++){
						scene.children[i].material.color.set( 0xFFFFFF );
					}
			}

			if(video.readyState === video.HAVE_ENOUGH_DATA){
				texture.needsUpdate = true;
			}
			renderer.render(scene, camera);
			window.requestAnimationFrame(render);
		}

		window.requestAnimationFrame(render);
		window.addEventListener( 'mousemove', onMouseMove, false );
		</script>
	</body>
</html>
